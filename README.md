# Platform_OneBot

是SeikoDIC对OneBot11平台的一个简单适配，计划长期支持Shamrock。



## 1. 事件匹配器

1. 群消息

   使用`[群]`进行匹配，例如：

   ```text
   [群]111
   222
   ```

2. 私聊消息

   使用`[私聊]`进行匹配，例如：

   ```text
   [私聊]222
   333
   ```

3. 通知消息

   通知消息分为`群事件`和`私聊事件`，且传入的消息为固定，下面为对照表：

   | 消息       | 所属事件 | 解释                                  |
   | ---------- | -------- | ------------------------------------- |
   | 群撤回     | 群事件   | 群中有一条消息被撤回                  |
   | 群成员增加 | -        | 群成员因为邀请/主动入群而使群成员增加 |
   | 群成员减少 | -        | 群成员因为被踢/退群而使群成员减少     |
   | 群管理变动 | -        | 群管理上任/罢免                       |
   | 群禁言     | -        | 有人被禁言/有群开启了全员禁言         |
   | 群名片修改 | -        | 有人修改了群名片                      |
   | 群精华     | -        | 有人添加/移除了群精华                 |
   | 私聊撤回   | 私聊事件 | 私聊中有一条消息被撤回                |
   | 好友添加   | -        | 有人添加你为好友                      |
   
   下面为举例：
   
   ```text
   [群事件]群撤回
   [私聊事件]好友添加
   ```

## 2. 内置变量

收到[群|好友]消息事件一定会内置的变量如下：

| 变量名 | 解释                       | 类型     | 例子       |
| ------ | -------------------------- | -------- | ---------- |
| 上下文 | 词条被触发时程序收到的包体 | 集合对象 | 略         |
| BOT    | 触发词条的机器人qq号       | 数字     | 1693256674 |
| QQ     | 触发词条的人的qq号         | 数字     | 485184047  |
| 昵称   | 触发词条的人的用户名       | 字符串   | 绪山真寻   |

其中：

群消息会内置：

| 变量名 | 解释                               | 类型       | 例子               |
| ------ | ---------------------------------- | ---------- | ------------------ |
| 群号   | 词条被触发的群号                   | 数字       | 572306032          |
| 名片   | 词条被触发的群名片(若未设置则为空) | 字符串     | 绪山真寻           |
| 权限   | 词条被处罚的人的权限               | 特定字符串 | owner/admin/member |

所有的通知消息都会内置：

| 变量名 | 解释                       | 类型     | 例子       |
| ------ | -------------------------- | -------- | ---------- |
| 上下文 | 词条被触发时程序收到的包体 | 集合对象 | 略         |
| BOT    | 触发词条的机器人qq号       | 数字     | 1693256674 |

通知消息的使用请解析对应的上下文集合，上下文集合包含的键请参考：https://whitechi73.github.io/OpenShamrock/event/notice.html

如果你不会使用花括号语法解析上下文对象，请参考：https://seikodictionaryenginev2.github.io/dist/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/5.%E5%8F%98%E9%87%8F%E5%8F%8A%E5%85%B6%E8%B5%8B%E5%80%BC.html#%E4%BA%8C-%E5%8F%96%E5%80%BC%E8%AF%AD%E6%B3%95

下面为举例：

```text
[群事件]群撤回
如果:{上下文.user_id}=={上下文.operator_id}
 你撤回了一条消息\n
如果尾
 管理员撤回了一条消息\n
QQ:{上下文.user_id}\n
操作人:{上下文.operator_id}
```



## 3. 特定指令

### 3.1 OneBot发包

- **指令**：`$OneBot发包 包类型 包体$`

- **返回值：**集合对象，代表本次回调的结果，成功示例如下：

  ```json
  {
      "data": {
          "message_id": 1597100000,
          "time": 1701097157
      },
      "echo": "5ec64699-8e39-4259-9928-115c6f6a177c",
      "retcode": 0,
      "status": "ok"
  }
  
  ```

  > 完整的回调集合请参考：https://whitechi73.github.io/OpenShamrock/api/request-response.html#%E5%93%8D%E5%BA%94

- **描述：**向连接的OneBot客户端发送一个数据包。本指令为阻塞式方法，在发送前会清空缓冲区。

- **示例：**

  ```text
  [群]ABC
  DATA<-///
  {
      "group_id": 572360632,
      "message": "你好啊\n---来自SeikoDICV2的跨群发送",
  }
  ///
  K<-$OneBot发包 send_group_msg {DATA}$
  {K}
  ```

### 3.2 获取BOT列表

- **指令**：`$获取BOT 列表$`

- **返回值：**集合对象，代表本次回调的结果，成功示例如下：

  ```json
  [
      {
          "nickname": "兔兔没有兔兔", //昵称
          "user_id": 1693256674, //qq
          "uuid": "1c578409-7dcb-447e-af99-b1e0feef7b2b" //为每个websocket提供的唯一id
      }
  ]
  ```

- **描述：**向所有连接的OneBot客户端发送查询当前在线BOT的数据包。本指令为阻塞式方法，在发送前会清空缓冲区。

- **示例：**

  ```text
  [群]bot列表测试
  A<-$获取BOT列表$
  {A}
  ```

### 3.1 端点切换

- **指令**：`$端点切换 uuid$`

- **返回值：**无，但是切换失败会抛错

- **描述：**切换`$OneBot发包$`命令的默认目标连接。

- **示例：**

  ```text
  [群]ABC
  DATA<-///
  {
      "group_id": 572360632,
      "message": "你好啊\n---来自SeikoDICV2的跨群发送",
  }
  ///
  K<-$OneBot发包 send_group_msg {DATA}$
  {K}
  ```

